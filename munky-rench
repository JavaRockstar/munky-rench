#!/bin/bash
#
#
#
#
# Munky-rench is the swiss army knife for apk modding in bash
# Licensed under GPL

dir=`pwd `
DESC="Munky Rench is the swiss-army knife of apk modding in Linux"
VERSION="VERSION 1.0 INITIAL RELEASE"



echo 
echo 
echo "   88.       .88  888      88  8888      88  888    888  888     888    "
echo "   8888.   .8'88  888      88  888 88    88  888  88       88   88      "
echo "   888'8. .8' 88  888      88  888   88  88  888888          888      "
echo "   888 '8.8'  88  888      88  888     8888  888  88         888    "
echo "   888  '8'   88  88888888888  888       88  888    888      888              "
echo "                                                 "
echo
echo "     .d8888888   88888888  8888     88  888888888  888    88  "
echo "    :88    888   888       888 88   88  888        888    88  "
echo "      '9888888   888888    888  88  88  888        888888888  "
echo "      888  888   888       888   88 88  888        888    88  "
echo "   8888    888   88888888  888    8888  888888888  888    88  "
echo
echo "                               FOR   "
echo
echo
echo "            88     8888  88b  88  88   88  88.   .88      "
echo "            88      88   888b 88  88   88   '88 88'   "
echo "            88      88   88 8b88  88   88     :8:          "
echo "            88      88   88  888  88   88   ,88 88,              "
echo "            888888 8888  88   88  8888888  88.   .88           "
echo 



echo "                        ENTER to continue"

read
echo $DESC                                        
echo $VERSION  
echo
echo "      ----miketheinkman---miketheinkman---miketheinkman----" 
echo


echo
echo
echo "                     APK MUNKY-BUSINESS "
echo "------------------------------------------------------------"

#frameworks
if [ -d "$dir/frameworks" ]

	then  :
		else

		mkdir $dir/frameworks



#place-here-for-modding
if [ -d "$dir/place-here-for-modding" ]

	then 	:

		else

 		mkdir $dir/place-here-for-modding
mkdir $dir/mod-projects


#zipalign
if [ -d "$dir/zipalign" ]

	then :

		else

		 mkdir $dir/zipalign



#sign
if [ -d "$dir/sign" ]

	then  :

		else
 
		 mkdir $dir/sign

#theme
if [ -d "$dir/theme-projects" ]

	then :

		else

		mkdir $dir/theme-projects

		
		fi
			fi
				fi
					fi
						fi
	


#choices
echo
echo
echo "---------------------MUNKY BUSINESS--------------------------"
echo "-------------------------------------------------------------"
echo "$DESC"
echo "$VERSION"
echo "-------------------------------------------------------------"
echo
echo "place apps in 'place-here-for-modding' directory"
echo
echo "-------------------------------------------------------------"

echo "1)unzip apk for theming" # functional


echo "2)zip themed apk" # functional


echo "3)install frameworks - important for recompiling!!!" # test

echo "4)decompile apk for modding" # functional


echo "5)recompile" # functional


echo "6)sign apk" 


echo "7)zipalign"


echo "8)recompile as system app- will not change signature"


echo "9)install app - requires adb"

                                                                                 
echo "99)exit" 


echo
echo
echo "------------------------------------------------------------"
echo
echo "pick your munky business"


read n

	case $n in

	1) # UNZIP
	
	echo
	echo
	echo
	echo "Unzipping an apk allows for the replacement of images,"
	echo "but does not allow for modification of code."
	echo
	echo "After replacing images, you must re-zip."
	echo
	echo "For more info, select 'help' from 'munky menu'"
	echo
	echo "press ENTER to continue"
	echo
	
	read

             cd $dir/place-here-for-modding

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
			
					cd $dir/place-here-for-modding
	

						OUTPUTS=`ls | sed -n $choice'p' `	



			
			unzip $dir/place-here-for-modding/$OUTPUTS -d $dir/theme-projects/$OUTPUTS

											
										


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "Unzipped files in 'theme' directory. You can now replace images for customization "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

				
					./munky-rench ;;


	2)  # ZIP APK
	
		echo
		echo
		echo
		echo "Zipping an apk simply repackages the files from"
		echo "an unzipped apk into a useable form."
		echo
		echo "Is not a substitute for compiling apk"
		echo
		echo "After zipping, apk is ready to install."
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
	
			 cd $dir/theme-projects

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `	



				
	
							mv $OUTPUTS temp

							cd temp
	
	
									zip -r -0 $OUTPUTS *
	
										mv $OUTPUTS themed_$OUTPUTS

											
										mv -f themed_$OUTPUTS $dir/out


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "themed apk in 'out' directory. Enjoy your new theme"
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir/theme-projects

					rm -Rf temp
		
					cd $dir

				
					./munky-rench ;;

	3) # INSTALL FRAMEWORK
	
	
		echo
		echo
		echo
		echo "Apks are designed to run within the existing"
		echo "framework of Android.  You must install the framework-res.apk"
		echo "from the /system/framework folder of your device."
		echo
		echo "Non AOSP roms usually have a proprietary framework also."
		echo "The location of these second frameworks will vary."
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo
		read
	
		cd $dir/frameworks	
			
		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `	



				
	
						apktool if $OUTPUTS

				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "Repeat process to add other frameworks "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

				
					./munky-rench ;;


	4) # DECOMPILE
	
		echo
		echo
		echo
		echo "Decompiling an apk reduces it to its editable source."
		echo "You can change the behavior and features of the app,"
		echo "IF you know what you are doing."
		echo
		echo "Java and Xml are the languages you will need to edit source."
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
	
		cd $dir/place-here-for-modding

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
			
					cd $dir/place-here-for-modding
	

						OUTPUTS=`ls | sed -n $choice'p' `	



							$dir/TOOLS/apktool d -f $OUTPUTS  -o $dir/mod-projects/$OUTPUTS

											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "Decompiled files in 'mod' directory. You can now replace images and edit or add code "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

				
					./munky-rench ;;

	5) # RECOMPILE
	
	
		echo
		echo
		echo
		echo "This will compile the source into byte code."
		echo "The app will not be ready to install until you sign it."
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
	
		cd $dir/mod-projects

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `	



							$dir/TOOLS/apktool b -f $OUTPUTS -o $dir/out/$OUTPUTS


						mv $dir/out/$OUTPUTS  $dir/out/unsigned_$OUTPUTS



											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "unsigned apk in 'out' directory. Sign and zipalign apk before install "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

			
					./munky-rench ;;
	
	6)

				echo
		echo
		echo
		echo "This will sign the apk"
		echo "The app will be ready to install after you sign it."
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
	
		cd $dir/out
		
		

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `
						#SIGN=`echo $OUTPUTS| sed -r 's/^.{9}//' `
						#OUTPUTS=$SIGN



							cd $dir/TOOLS


						java -jar signapk.jar testkey.x509.pem /home/mike/android/munky-rench/TOOLS/testkey.pk8 $dir/out/$OUTPUTS $dir/out/signed_$OUTPUTS



											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "signed apk in 'out' directory. Sign and zipalign apk before install "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

			
					./munky-rench ;;
			


	7) # ZIPALIGN
	
	
	
		echo "place apk to be zipaligned in 'zipalign' directory"
		
		echo "press ENTER when ready"	

			read	
		

		cd $dir/zipalign

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `
						
							

					cd $dir/TOOLS

				./zipalign 4 $dir/zipalign/$OUTPUTS $dir/out/zipaligned_$OUTPUTS			

				
						



											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "zipaligned apk in 'out' directory. "
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

			
					./munky-rench ;;
	


        8) # COMPILE AS SYSTEM APP
        
        				echo
		echo
		echo
		echo "Compiles apk using original META_INF."
		
		
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
        
		cd $dir/mod-projects

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `	



							$dir/TOOLS/apktool b -f $OUTPUTS -o $dir/out/$OUTPUTS

#unzip compiled apk to staging
							unzip $dir/out/$OUTPUTS -d $dir/staging/

#copy original to keep
					cp $dir/place-here-for-modding/$OUTPUTS $dir/$OUTPUTS

#unzip original		

							unzip $dir/$OUTPUTS -d $dir/keep/
			
#copy meta to staging
				 cd $dir/keep/

							 mv META-INF $dir/staging/META-INF



				cd $dir/staging
#zip staging				 
				 	zip -r -0 $OUTPUTS *
				 	
				 		mv $OUTPUTS $dir/out/system_$OUTPUTS

							cd $dir/out
								rm $OUTPUTS
							
								cd $dir
	
								rm -Rf keep

								rm -Rf staging

								rm $OUTPUTS

			

											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "Compiled SYSTEM apk in 'out' directory."
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

				rmdir staging

				
					./munky-rench ;;


	9)

			echo
		echo
		echo
		echo "This will install selected apk to your device."
		echo "Does not work for system apps"
		echo
		echo "For more info, select 'help' from 'munky menu'"
		echo
		echo "press ENTER to continue"
		echo	
		read
	
		cd $dir/mod-projects

		ls | cat -n

			echo
				
				echo
  

			echo "Which file? Enter number of selection or 'x' to exit"

				read choice


		
		
			
			if [ $choice = 'x' ]  ; then 
	
		
					echo "are you sure? Press ENTER to exit"
			
						read
			
							exit

			
				else	
	

						OUTPUTS=`ls | sed -n $choice'p' `	



							adb install $OUTPUTS


											
								


				echo
				echo
				echo
				echo "--------------------------------------------------------------"
				echo						 			
				echo "app installed."
				echo "ENTER to return to munky menu"

				read

		
		fi
	
				cd $dir

			
					./munky-rench ;;
  

	99)


		exit ;;



esac

read 



exit 0
